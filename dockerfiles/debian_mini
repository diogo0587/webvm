# Debian 11 (bullseye) ainda tem suporte LTS para i386.[web:6][web:15]
FROM --platform=i386 i386/debian:bullseye

ARG DEBIAN_FRONTEND=noninteractive

# Atualização + instalação em uma só layer, sem caches de APT.[web:7]
RUN apt-get update \
 && apt-get -y upgrade \
 && apt-get -y install --no-install-recommends \
        apt-utils \
        gcc \
        python3 \
        python3-pip \
        vim \
        unzip \
        ruby \
        nodejs \
        fakeroot \
        dbus \
        base-files \
        whiptail \
        hexedit \
        patch \
        wamerican \
        ucf \
        manpages \
        file \
        luajit \
        make \
        lua5.3 \
        dialog \
        curl \
        less \
        cowsay \
        netcat-openbsd \
 && rm -rf /var/lib/apt/lists/*

# Criação de usuário não root.[web:7]
RUN useradd -m user && echo "user:password" | chpasswd

# Copia exemplos com permissões do usuário.
COPY --chown=user:user ./examples /home/user/examples
RUN chmod -R +x /home/user/examples/lua

WORKDIR /home/user/

ENV HOME="/home/user" \
    TERM="xterm" \
    USER="user" \
    SHELL="/bin/bash" \
    EDITOR="vim" \
    LANG="en_US.UTF-8" \
    LC_ALL="C"

# Define senha do root (se realmente precisar).
RUN echo 'root:password' | chpasswd

USER user

CMD ["/bin/bash"]